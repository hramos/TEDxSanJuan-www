--- 
name: drop-in-reachability-check
layout: post
title: Drop In Reachability Check
time: 2010-12-14 15:15:00 -04:00
---
<p>Every iOS application that requires an Internet connection should make use of the Apple <a href="http://developer.apple.com/library/ios/#samplecode/Reachability/Introduction/Intro.html">Reachability</a> classes. These allow you to easily check if there is a WAN connection available and/or if a specific host can be reached.</p><br/><p>You never know when your application will run in Airport mode or in a dead area with no cell connection at all. Furthermore, the user might not have 3G service but might be connected through a Wi-Fi hotspot. Perhaps in a future OS update, an additional WAN connection might become available through Bluetooth or a completely new protocol. For these reasons, I can&#8217;t advise you to create your own Reachability code, when Apple&#8217;s will suffice: you only care if there is access to a WAN, or at the very least, if Host X is reachable (who cares about the pathway to it?).</p><br/><p>In iPhone OS 2, the Reachability classes were kind of obscure, hidden away in the Apple Sample Code and with no easy way of dropping them in to a project. By default they were synchronous and would need some modification to work properly asynchronously - I don&#8217;t really remember the details, I just remember I had to do this a couple of times and it was very annoying. So I was very happy to find <a href="http://stackoverflow.com/questions/1083701/how-to-check-for-an-active-internet-connection-on-iphone-sdk/3597085#3597085">this answer in Stack Overflow</a> which provides a step by step to use the updated Reachability classes along with NSNotifications to asynchronously determine reachability.</p><br/><p>You should always <a href="http://stackoverflow.com/questions/1083701/how-to-check-for-an-active-internet-connection-on-iphone-sdk/3597085#3597085">visit Stack Overflow to get the latest code and comments</a>, but I&#8217;m saving a local copy here for posterity:</p><br/><blockquote><br/><p>An updated answer:</p><br/><p>1) Add&nbsp;<code>SystemConfiguration</code>&nbsp;framework to the project but don&#8217;t worry about including it anywhere</p><br/><p>2) Add&nbsp;<code>Reachability.h</code>&nbsp;and&nbsp;<code>Reachability.m</code>&nbsp;to the project</p><br/><p>3) Add&nbsp;<code>@class Reachability;</code>&nbsp;to the .h file of where you are implementing the code</p><br/><p>4) Create a couple instances to check in the&nbsp;<code>interface</code>&nbsp;section of the .h file:</p><br/><pre class="prettyprint lang-c"><code><span class="pln">&nbsp; &nbsp; </span><span class="typ">Reachability</span><span class="pun">*</span><span class="pln"> internetReachable</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="typ">Reachability</span><span class="pun">*</span><span class="pln"> hostReachable</span><span class="pun">;</span><span class="pln"><br /></span></code></pre><br/><p>5) Add a method in the .h for when the network status updates:</p><br/><pre class="prettyprint lang-c"><code><span class="pln">&nbsp; &nbsp; </span><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">void</span><span class="pun">)</span><span class="pln"> checkNetworkStatus</span><span class="pun">:(</span><span class="typ">NSNotification</span><span class="pln"> </span><span class="pun">*)</span><span class="pln">notice</span><span class="pun">;</span><span class="pln"><br /></span></code></pre><br/><p>6) Add&nbsp;<code>#import "Reachability.h"</code>&nbsp;to the .m file where you are implementing the check</p><br/><p>7) In the .m file of where you are implementing the check, you can place this in one of the first methods called (<code>init</code>&nbsp;or&nbsp;<code>viewWillAppear</code>&nbsp;or&nbsp;<code>viewDidLoad</code>&nbsp;etc):</p><br/><pre class="prettyprint lang-c"><code><span class="pln">&nbsp; &nbsp; </span><span class="pun">-(</span><span class="kwd">void</span><span class="pun">)</span><span class="pln"> viewWillAppear</span><span class="pun">:(</span><span class="pln">BOOL</span><span class="pun">)</span><span class="pln">animated<br />&nbsp; &nbsp; </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// check for internet connection</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">[[</span><span class="typ">NSNotificationCenter</span><span class="pln"> defaultCenter</span><span class="pun">]</span><span class="pln"> addObserver</span><span class="pun">:</span><span class="pln">self selector</span><span class="pun">:</span><span class="lit">@selector</span><span class="pun">(</span><span class="pln">checkNetworkStatus</span><span class="pun">:)</span><span class="pln"> name</span><span class="pun">:</span><span class="pln">kReachabilityChangedNotification object</span><span class="pun">:</span><span class="pln">nil</span><span class="pun">];</span><span class="pln"><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; internetReachable </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[[</span><span class="typ">Reachability</span><span class="pln"> reachabilityForInternetConnection</span><span class="pun">]</span><span class="pln"> retain</span><span class="pun">];</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">[</span><span class="pln">internetReachable startNotifier</span><span class="pun">];</span><span class="pln"><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// check if a pathway to a random host exists</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; hostReachable </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[[</span><span class="typ">Reachability</span><span class="pln"> reachabilityWithHostName</span><span class="pun">:</span><span class="pln"> </span><span class="pun">@</span><span class="str">"www.apple.com"</span><span class="pun">]</span><span class="pln"> retain</span><span class="pun">];</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">[</span><span class="pln">hostReachable startNotifier</span><span class="pun">];</span><span class="pln"><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// now patiently wait for the notification</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br /></span></code></pre><br/><p>8) Set up the method for when the notification gets sent and set whatever checks or call whatever methods you may have set up (in my case, I just set a BOOL)</p><br/><pre class="prettyprint lang-c"><code><span class="pln">&nbsp; &nbsp; </span><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">void</span><span class="pun">)</span><span class="pln"> checkNetworkStatus</span><span class="pun">:(</span><span class="typ">NSNotification</span><span class="pln"> </span><span class="pun">*)</span><span class="pln">notice<br />&nbsp; &nbsp; </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp;</span><span class="com">// called after network status changes</span><span class="pln"><br /><br />&nbsp; &nbsp; &nbsp;</span><span class="typ">NetworkStatus</span><span class="pln"> internetStatus </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">internetReachable currentReachabilityStatus</span><span class="pun">];</span><span class="pln"><br />&nbsp; &nbsp; &nbsp;</span><span class="kwd">switch</span><span class="pln"> </span><span class="pun">(</span><span class="pln">internetStatus</span><span class="pun">)</span><span class="pln"><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">case</span><span class="pln"> </span><span class="typ">NotReachable</span><span class="pun">:</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp;</span><span class="typ">NSLog</span><span class="pun">(@</span><span class="str">"The internet is down."</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp;self</span><span class="pun">.</span><span class="pln">internetActive </span><span class="pun">=</span><span class="pln"> NO</span><span class="pun">;</span><span class="pln"><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">break</span><span class="pun">;</span><span class="pln"><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">case</span><span class="pln"> </span><span class="typ">ReachableViaWiFi</span><span class="pun">:</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp;</span><span class="typ">NSLog</span><span class="pun">(@</span><span class="str">"The internet is working via WIFI."</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp;self</span><span class="pun">.</span><span class="pln">internetActive </span><span class="pun">=</span><span class="pln"> YES</span><span class="pun">;</span><span class="pln"><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">break</span><span class="pun">;</span><span class="pln"><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">case</span><span class="pln"> </span><span class="typ">ReachableViaWWAN</span><span class="pun">:</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp;</span><span class="typ">NSLog</span><span class="pun">(@</span><span class="str">"The internet is working via WWAN."</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp;self</span><span class="pun">.</span><span class="pln">internetActive </span><span class="pun">=</span><span class="pln"> YES</span><span class="pun">;</span><span class="pln"><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">break</span><span class="pun">;</span><span class="pln"><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; &nbsp;</span><span class="pun">}</span><span class="pln"><br /><br />&nbsp; &nbsp; &nbsp;</span><span class="typ">NetworkStatus</span><span class="pln"> hostStatus </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">hostReachable currentReachabilityStatus</span><span class="pun">];</span><span class="pln"><br />&nbsp; &nbsp; &nbsp;</span><span class="kwd">switch</span><span class="pln"> </span><span class="pun">(</span><span class="pln">hostStatus</span><span class="pun">)</span><span class="pln"><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">case</span><span class="pln"> </span><span class="typ">NotReachable</span><span class="pun">:</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp;</span><span class="typ">NSLog</span><span class="pun">(@</span><span class="str">"A gateway to the host server is down."</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp;self</span><span class="pun">.</span><span class="pln">hostActive </span><span class="pun">=</span><span class="pln"> NO</span><span class="pun">;</span><span class="pln"><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">break</span><span class="pun">;</span><span class="pln"><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">case</span><span class="pln"> </span><span class="typ">ReachableViaWiFi</span><span class="pun">:</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp;</span><span class="typ">NSLog</span><span class="pun">(@</span><span class="str">"A gateway to the host server is working via WIFI."</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp;self</span><span class="pun">.</span><span class="pln">hostActive </span><span class="pun">=</span><span class="pln"> YES</span><span class="pun">;</span><span class="pln"><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">break</span><span class="pun">;</span><span class="pln"><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">case</span><span class="pln"> </span><span class="typ">ReachableViaWWAN</span><span class="pun">:</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp;</span><span class="typ">NSLog</span><span class="pun">(@</span><span class="str">"A gateway to the host server is working via WWAN."</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp;self</span><span class="pun">.</span><span class="pln">hostActive </span><span class="pun">=</span><span class="pln"> YES</span><span class="pun">;</span><span class="pln"><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">break</span><span class="pun">;</span><span class="pln"><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; &nbsp;</span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br /></span></code></pre><br/><p>9) In your&nbsp;<code>dealloc</code>&nbsp;or&nbsp;<code>viewWillDisappear</code>&nbsp;or similar method, remove yourself as an observer</p><br/><pre class="prettyprint lang-c"><code><span class="pln">&nbsp; &nbsp; </span><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">void</span><span class="pun">)</span><span class="pln"> viewWillDisappear</span><span class="pun">:(</span><span class="pln">BOOL</span><span class="pun">)</span><span class="pln">animated<br />&nbsp; &nbsp; </span><span class="pun">{</span><span class="pln"><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">[[</span><span class="typ">NSNotificationCenter</span><span class="pln"> defaultCenter</span><span class="pun">]</span><span class="pln"> removeObserver</span><span class="pun">:</span><span class="pln">self</span><span class="pun">];</span><span class="pln"><br /><br />&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br /></span></code></pre><br/><p>Note: There might be an instance using&nbsp;<code>viewWillDisappear</code>&nbsp;where you receive a memory warning and the observer never gets unregistered so you should account for that as well.</p><br/></blockquote><br/><br/><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/4308278671813780009-358496059795223008?l=hector-omar.blogspot.com' alt='' /></div>
